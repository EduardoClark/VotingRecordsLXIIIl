{
    "collab_server" : "",
    "contents" : "require(RCurl)\nrequire(rvest)\nrequire(dplyr)\nrequire(tidyr)\n\n#GetRecord Function\nDB <- function(Y){\n  print(Y)\n  #Get Candidate Info\n  D0 <- read_html(paste(\"http://sitl.diputados.gob.mx/LXIII_leg/curricula.php?dipt=\",Y,sep=\"\"))\n  D0 <- D0 %>% html_table(fill=T)\n  D0 <- as.data.frame(D0[3])[-1,1:2]\n  D0[1,1] <- \"Nombre\"\n  D0 <- D0 %>% mutate(X1=gsub(pattern=\":\",replacement=\"\",x=X1),X1=gsub(pattern=\" \",replacement=\"\",x=X1)) %>%\n    spread(X1,X2)\n  \n  #Get Voting Record\n  VotingPeriods <- paste(\"http://sitl.diputados.gob.mx/LXIII_leg/votaciones_por_pernplxiii.php?iddipt=\",Y,\"&pert=\",c(1,3,5,6,7,9,11),sep=\"\")\n  VoteRecord <- function(X){\n    T0 <- read_html(X)\n    tryCatch({\n      T0 <- html_table(x = T0,fill=T)\n      T0 <- as.data.frame(T0[3])[-c(1:3),]\n      T0 <- T0 %>% mutate(X1=ifelse(nchar(X1)<5,NA,X1)) %>% fill(X1) %>% select(-X3,-X5) %>%\n        filter(X1!=X2) \n      names(T0) <- c(\"Fecha\",\"Titulo\",\"Sentido\")\n      F0 <- cbind(D0,T0)\n      return(F0)\n    },error=function(cond) {\n      F0 <- data.frame(X1 =NA,X2 =NA,X3 =NA,X4 =NA,X5 =NA,X6=NA,X7 =NA,X8 =NA,X9 =NA)\n      names(F0) <- c('Correoelectrónico','Entidad','Nombre','Onomástico','Suplente','Tipodeelección','Fecha','Titulo','Sentido')\n      return(F0)\n    })\n  }\n  F0 <- bind_rows(lapply(VotingPeriods,VoteRecord))\n  return(F0)\n}\n\n#Get complete DB for all 500 deputies\nVotes <- bind_rows(lapply(1:500,DB))\n\n#Clean \nVotes <- Votes %>% filter(is.na(Nombre)!=T)\n\n#Export\nwrite.csv(\"data-out/votesdb.csv\",row.names = F)\n\n\n",
    "created" : 1507788191242.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3007644013",
    "id" : "85A0F349",
    "lastKnownWriteTime" : 1507788295,
    "last_content_update" : 1507788295591,
    "path" : "~/VotingRecordsLXIIIl/src/GetVotes.R",
    "project_path" : "src/GetVotes.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}